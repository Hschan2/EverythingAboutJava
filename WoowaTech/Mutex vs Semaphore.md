# Mutex vs Semaphore

## 들어가기 전
* 교착 상태: 두 가지 이상의 작업이 서로 상대방의 작업이 끝나기만을 기다리는 상태   

여기서, 공유 자원이 속해 있어 교착 상태가 발생할 수 있는 영역을 <b>임계 영역</b>이라고 한다.   

교착 상태가 발생하기 위한 조건은 네 가지가 있다. 이 중 한 가지라도 만족하지 않는다면 교착 상태가 발생하지 않는다.   
* 상호 배제
* 점유 대기
* 비선점
* 순환 대기   

이 중에서 주제와 관련된 <b>상호 배제</b>를 이해하기로 한다.   

## 상호 배제 (Mutual Exclusion)
프로세스들이 필요로 하는 자원에 대해 배타적인 통제권을 요구하는 것이다. 즉, 하나의 프로세스가 공유 자원에 접근했을 때 다른 프로세서는 접근할 수 없도록 통제하는 것이다.   

Mutex는 Mutual Exclusion를 합쳐서 줄인 말이다. 이는 여러 스레드를 실행하는 환경에서 자원에 대한 접근에 제한을 강제하기 위한 <b>동기화 매커니즘</b>을 말한다.   

* [예시로 쉽게 이해하기](https://youtu.be/oazGbhBCOfU?t=172)   

임계 영역에서 하나의 스레드가 접근했을 경우, 다른 스레드가 들어올 수 없도록 잠금 상태가 된다. 이를 <b>Lock 방식</b>이라고 한다.   

만약 다른 스레드가 접근을 한다면 대기를 시키고 이전의 스레드가 처리 완료가 되었을 때, 순서대로 접근할 수 있도록 한다. 즉, 영역에 스레드가 있을 경우 다른 스레드가 접근했을 때 해당 스레드를 Blocking을 하고 대기큐에 Sleep을 시킨다. (Mutex Sleeping-waiting Blocking-lock)   

또는 다른 스레드가 접근했을 때 대기하지 않고 계속 접근을 시도하는 것을 <b>SpinLock 방식</b>이라고 한다. 그리고 계속 접근을 시도하여 자리를 요청하는 행위를 <b>Busy-waiting</b>이라고 한다. 이 방식은 지속적으로 접근을 시도하기 때문에 이를 계속 대응해야 하는 비효율적인 단점이 있다. 이 방식을 사용하는 상황은 두 가지가 있다.   

첫 번째는 대기하는 시간보다 입구에서 바로 접근할 수 있는 예상 시간이 짧을 때이다. 즉, 컨텍스트 스위칭 시간이 더 짧을 때 사용할 수 있다..   

두 번째는 다른 스레드가 요청했을 때 이에 응해줄 수 있는 프로세스가 많을 때이다. 즉, 멀티 코어 프로세스일 때 사용할 수 있다.   

## Semaphore
사전적 정의는 멀티 프로그래밍 환경에서 다수의 프로세스나 스레드의 여러 개의 공유 자원에 대한 접근을 제한하는 방법이다. Mutex와 다르게 여러 스레드가 임계 영역에 접근을 할 수 있다. 그러나 스레드가 접근을 했을 때 점유에 대한 규칙이 필요하다. 스레드가 접근을 한 순간 점유를 한 것으로 정한다. 그리고 스레드가 접근을 하여 점유를 하고(이를 <b>P</b>라고 한다.) 모든 것을 마친 후 나가는 순간(이를 <b>V</b>라고 한다.)을 <b>Atomic Operation</b>이라고 한다.   

<b>P</b>는 Proberen이라고 말하며 네덜란드어로 <b>테스트를 하다</b>라는 뜻을 가지고 있고 함수로는 ```Wait```을 사용한다.   

<b>V</b>는 Verhogen이라고 말하며 네덜란드어로 <b>증가하다</b>라는 뜻을 가지고 있고 함수로는 ```Signal```을 사용한다.   

만약, 모두 점유한 상태일 때 다른 스레드가 접근을 할 경우 대기하는 방법은 두 가지가 있다.   

첫 번째는 <b>Sleep-waiting 방식</b>으로 대기 큐에서 잠자는 상태로 대기하고 있다가 접근이 가능할 경우 스레드를 깨우는 방식이다.   

두 번째는 <b>Busy-waiting 방식</b>으로 Spinlock 방식을 생각하면 된다. 즉, 접근이 가능할 때까지 계속 검사(요청)를 한다.   

## 정리
* Mutex (뮤텍스)
    * 여러 스레드를 사용하는 환경에서 자원에 대한 접근을 강제하기 위한 동기화 매커니즘
    * Boolean 타입의 Lock 변수 사용
    * 공유 자원을 사용중인 스레드가 있을 때, 다른 스레드가 공유 자원에 접근한다면 Blocking 후 대기 큐로 보냄
    * Lock을 건 스레드만 Lock을 해제 가능
* Spinlock (스핀락)
    * 기본적으로 Mutex와 유사
    * Busy-waiting 방식을 사용하며 대기 큐를 갖지 않음
    * Mutex-nonblocking 모델로 볼 수 있음
* Semaphore (세마포어)
    * 세마포어 변수를 통해서 Wait, Signal을 관리
    * 세마포어 변수는 0 이상의 정수형 변수를 갖음
    * 계수 세마포어로 사용 가능하며 접근 가능한 공유 자원의 수가 1개일 때는 이진 세마포어로 Mutex처럼 사용 가능
    * Lock을 걸지 않은 스레드도 Signal을 보내어 Lock 해제 가능   

[Mutex vs Semaphore](https://www.youtube.com/watch?v=oazGbhBCOfU)