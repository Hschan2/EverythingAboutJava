# Process vs Thread (프로세스 vs 스레드)

## 시작 전 Keywords
* 실행 단위: CPU Core에서 실행하는 하나의 단위로 프로세스와 스레드를 포괄하는 개념
* 프로세스: 하나의 스레드만 가지고 있는 단일 스레드 프로세스
* 동시성: 한 순간에 여러가지 일이 아닌 짧은 전환으로 여러가지 일을 동시에 처리하는 것처럼 보이는 것   

## 프로그램이 프로세스가 되면서 일어나는 일 2가지
1. 프로세스가 필요로 하는 재료들이 메모리에 올라가야 한다.   
```
메모리

Code - 실행 명령을 포함하는 코드들
Data - Static 변수 혹은 Global 변수
Heap - 동적 메모리 영역
Stack - 지역변수, 매개변수, 반환 값 등 일시적은 데이터
```

2. 해당 프로세스에 대한 정보를 담고 있는 PCB 블럭이 프로세스 생성 시 같이 생성해진다.   
```
Process Control Block

프로세스 상태 중 준비 상태
대기상태의 큐를 구현하기 위해 필요한 포인터
현재 프로세스 상태를 담는 Process State
고유번호를 담은 PID
다음 명령어를 가리키는 프로그램 카운터
등
```

## Process & Thread
여러 개의 프로세스를 동시에 실행하기 위해서는 첫 번째 프로세스가 실행 단계가 있으면 두 번째 프로세스는 준비 단계로 다시 첫 번째 프로세스가 준비 단계로 두 번째 프로세스가 실행 단계로 빠르게 동작해야 한다.   

이 과정이 굉장히 힘든 과정이기 때문이 이를 경량화한 프로세스 버전인 스레드가 등장한다. 스레드는 하나의 프로세스 안에 다수의 스레드가 있을 때, 공유되는 자원이 있기 때문에 경량화되었다고 한다.   

각 스레드는 스택 부분만을 따로 가지고 있다. 공유되는 자원이 있기 때문에 컨텍스트 스위칭이 일어날 때, 캐싱 적중률이 증가한다. 쉽게 말해 모두 다 빼고 다시 다 넣을 필요가 없다는 것이다.   

## Multi-Process & Multi-Thread
멀티 프로세스와 멀티 스레드는 처리 방식의 일종이다. 그리고 하나의 프로세스는 하나의 처리만 할 수 있기 때문에 동시에 처리할 수 없다. 그래서 부모 프로세스가 ```fork()```를 사용해서 자식 프로세스를 여러 개 만들어서 일을 처리하게 한다. 이 때, 자식 프로세스는 부모와 별개의 메모리 영역을 확보하게 된다.   

스레드는 한 프로세스 내에서 구분지어진 실행 단위이다. (프로세스 그 자체) 즉, 해당 프로세스의 하나밖에 없는 스레드가 실행 단위가 되는 것이다. 프로세스 내에서 분리해서 여러 스레드로 나누어져 실행 단위가 나뉘어지면 멀티 스레드가 된다.   

한 애플리케이션에 대한 작업의 단위가 나누어질 때, 각각의 스레드가 해당 작업들을 담당하게 된다. 그리고 프로세스는 독립적이기 때문에 IPC를 통해서 통신해야 한다.   

* 멀티 프로세스
    * 각 프로세스는 독립적
    * IPC를 사용한 통신
    * 자원 소모적, 개별 메모리 차지
    * Context Switching 비용이 큼
    * 동기화 작업이 필요하지 않음   

* 멀티 스레드
    * 동기화를 신경써야 함
    * 스레드끼리 긴밀하게 연결되어 있음
    * 공유된 자원으로 통신 비용 절감
    * 공유된 자원으로 메모리가 효율적임
    * Context Switching 비용이 적음
    * 공유 자원 관리 필수   

### 멀티 스레드 대신 멀티 프로세스를 사용하는 이유
인터넷을 사용하다가 하나의 탭에 문제가 생기면 다른 탭까지 모두 사용하지 못하는 문제는 멀티 스레드를 사용했기 때문이다. 

## Multi-Core (멀티 코어)
<b>멀티코어</b>는 위 두개와 달리 하드웨어 측면에서 가깝다. 멀티코어와 관련된 용어는 <b>동시성</b>과 <b>병렬처리</b>이다. 싱글코어는 위에서 설명했듯이 여러 개의 일을 수행하기 위해서는 빠르게 텀으로 전환이 되면서 실행되는 것으로 동작한다. 이를 <b>동시성</b>이라고 한다.   

* 동시성: 짧은 순간에 CPU의 시간을 분할해서 동시에 움직이는 것처럼 보이게 함. 즉, 하나의 코어에서 하나 이상의 프로세스(스레드)가 번갈아가면서 진행되지만 동시에 진행되는 것처럼 보이는 것.   

멀티코어는 병렬처리를 하며, 여러 코어를 사용해서 다수의 실행 단위를 한 번에 처리할 수 있게 한다.   

* 병렬처리: 둘 이상의 코어에서 동시에 하나 이상의 프로세스(스레드)가 한 번에 진행되는 것.   

### 번외
리눅스 커널에서는 프로세스와 스레드를 동일하게 인지한다. 리눅스는 일대일 모델이며 사용자 스레드당 커널 스레드 하나가 매칭이 된다. 그래서 ```각각의 스레드가 하나의 프로세스다```라고 표현을 한다.   

각각 다른 메모리를 가진 것과 조금 다르게 메모리를 공유한다. 그래서 Light Weight Process라고 구분해서 부른다. 그렇다고 각각의 고유번호인 PID가 다른 것은 아니다.

## 요약
* 프로세스는 프로그램이 실행된 것
* 스레드는 한 프로세스 내에서 나뉘어진 하나 이상의 실행 단위
* 한 애플리케이션에 대한 작업을 동시에 하기 위해서는 두 가지 처리 방식(멀티 프로세스, 멀티 스레드) 존재
* 동시에 실행이 되는 것처럼 보이기 위해 실행 단위는 시분할로 CPU를 점유하며 Context Switching 함
* 멀티 프로세스는 독립적인 메모리를 가지고 있지만 멀티 스레드는 자원을 공유 (각각 장점과 단점이 존재)
* 멀티 코어는 하드웨어 측면에서 실행 단위를 병렬적으로 처리할 수 있도록 여러 프로세서가 존재   

[출처](https://www.youtube.com/watch?v=1grtWKqTn50)