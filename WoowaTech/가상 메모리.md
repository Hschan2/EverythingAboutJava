# 가상 메모리

## 개념
<b>가상 메모리</b>는 메모리 관리 기법 중 하나로 프로세스 전체가 메모리 내에 올라오지 않더라도 실행이 가능하도록 하는 기법이다.   

가상 메모리의 장점은 다음과 같다.   

* 사용자 프로그램이 물리 메모리의 제약에서 벗어난다.
* 각 프로그램이 더 작은 메모리를 차지하기 때문에 더 많은 프로그램을 동시에 수행이 가능하다. (동시로 수행이 가능한 것처럼 보이는 것)
* 프로그램을 메모리에 올리고 Swap을 하는데 필요한 IO 횟수가 줄어든다.   

가상 메모리를 이해하기 위해서는 컴퓨터 구조, 프로그램이 실행되는 것의 의미, 주소 바인딩(가상 메모리를 위해서 실행 시간 바인딩 필요), 스왑 영역 등 사전 배경 지식이 필요하다. [사전 배경 지식 이해하기](https://youtu.be/5pEDL6c--_k?t=61)   

* 시분할 방식: CPU가 하나라고 가정할 때, 하나의 CPU가 여러 프로세스를 짧은 시간 내에 바꾸어가며 사용하여 여러 개의 프로세스를 동시에 사용하는 것처럼 보이는 것
* 스왑 영역: 물리 메모리에 프로세스가 올라갈 공간이 부족할 경우, 메모리 공간 확장 영역으로 스왑 영역을 사용. 프로세스가 실행중일 때만 일시적으로 저장   

## 가상 메모리가 필요한 이유
실행되고 있는 프로세스의 정보는 물리 메모리에 올라가 있음을 가정한다. 여러 개의 프로그램을 실행하는 환경에서 물리 메모리를 나눠서 사용한다. 즉, 여러 개를 사용할 수록 물리 메모리의 크기가 줄어든다. 그래서 꼭 필요한 프로세스만 물리 메모리에 두고 다른 프로세스는 스왑 영역에 둔다. 만약 크기가 큰 프로세스라면 물리 메모리의 공간이 부족하여 사용이 불가하다. 그래서 가상 메모리가 필요하다.   

## 가상 메모리의 모든 논리 주소를 물리 메모리에 올려야 하는가?
가상 메모리를 사용하면 모든 프로세스를 메모리에 올릴 필요 없이 필요한 부분만 메모리에 올려서 실행이 가능하다.   

* 요구 페이징 기법(Demand Paging): 필요한 페이지만 물리 메모리에 적재하는 기법   

<b>요구 페이징 기법</b>은 당장 필요한 프로세스들을 메모리에 적재하여 실행하도록 한다. 가장 필요한 프로세스를 알기 위해서 <b>유-무효 비트</b>를 사용한다.   

* Valid: 해당 페이지가 메모리에 있다.
* Invalid: 해당 페이지가 메모리에 없다.
    * 해당 페이지가 가상 공간에 없다. => 해당 프로세스는 중단한다.
    * 보조저장장치에 존재한다. => 보조저장장치에서 가져온다.
    * Page Fault: 한 명령어에서도 여러 번의 페이지 폴트가 일어날 수 있지만 <b>참조지역성</b>으로 성능이 괜찮다.   

* [요구 페이징 기법 동작 원리](https://youtu.be/5pEDL6c--_k?t=450)   

<b>요구 페이징 기법</b>을 사용하면 큰 공간인 스왑 영역을 사용하여 프로세스마다 가상의 주소 공간을 확보하고 필요한 페이지만 물리 메모리에 올려서 사용하여 더 효과적으로 물리 메모리를 사용할 수 있다. 그리고 운영 체제에는 프로그램이 물리적 메모리의 크기를 고려할 필요 없이 자기 자신만의 메모리를 사용하는 것처럼 가정하여 프로그램하는 것을 지원한다.   

## 가상 메모리 정리
* 사용자 프로그램이 물리 메모리의 제약에서 벗어난다.
    * 사용자 프로그램이 물리 메모리보다 커도 된다.
    * 프로그래머는 물리 메모리 크기를 신경쓰지 않아도 되기 때문에 실제 해결하고자 하는 문제에 집중이 가능하다.
* 각 프로그램이 더 작은 메모리를 차지하기 때문에 더 많은 프로그램을 동시에 수행이 가능하다. (가능한 것처럼 보이는 것)
    * 프로세스 당 메모리 사용량이 감소하고, 더 많은 프로세스를 수용이 가능하다.
    * 응답 시간(Response Time, Turn Around Time)은 늘지 않고 CPU 이용률과 처리률이 높아진다.
* 프로그램을 메모리에 올리고 Swap을 하는데 필요한 IO(입출력, Input/Output) 횟수가 줄어든다.
    * IO가 적게 일어나기 때문에 더 빨리 실행이 가능하다.

[가상 메모리](https://www.youtube.com/watch?v=5pEDL6c--_k)