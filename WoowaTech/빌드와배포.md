# 빌드와 배포

## Build (빌드) 간단 정의
소스 코드를 실행 가능한 독립된 소프트웨어 가공물로 변형하는 과정

## 컴파일
소스 코드를 기계가 읽을 수 있는 <b>바이너리 코드</b>로 변경하는 과정이며, 소스 코드 분석 및 문법 오류 분석이 이루어진다. (자바의 경우, Class까지)   

### 자바에서 Class로 결과물이 나오는 이유
컴파일을 하게 될 때, 문제가 발생할 수 있다. 예를 들어서 하나의 문서를 번역할 때, 한국어와 영어 그리고 일본어로 각각 번역해야 하는 문제가 발생하는 경우를 막기 위해 JVM을 사용한다.   

### JVM
<b>Java Virtual Machine</b>의 약자로 Java Byte Code를 OS에 맞게 실행하며 자바의 <b>높은 이식성</b>에 큰 영향을 준다. 만약에 JVM이 없었다면 OS 마다 컴파일을 해야하는 문제가 발생할 것이다. 그러나 JVM이 있다면 클래스로만 작성하고 각각 운영체제 위의 JVM에서 코드를 동작하게 하면 된다.   

## Build (빌드)
크게 정의해서 소스 코드를 실행 가능한 독립적인 소프트웨어 산출물로 만드는 과정을 의미한다.

### 빌드 과정
1. 컴파일: 소스 코드를 바잉너리 코드로 변환   
2. 링크: 클래스 파일들끼리 연결 (외부 라이브러리 포함)   
3. 패키징: 연결된 클래스 및 리소스 파일 묶기   
4. 테스트: 기능 테스트   

그리고 나서 빌드 결과물 (독립적인 소프트웨어 산출물로 묶음)로 JAR, WAR로 출력된다.   

* JAR(Java Archive): 자바에서 사용되는 압축 양식, 클래스 + 리소스 파일로 구성
* WAR(Web Archive): 웹 애플리케이션을 압축하고 배포하는데 사용되는 파일 형식, JAR에 비해 자바 서블릿, XML 파일, 정적 파일 등 필요한 자원이 더욱 많다.   

### 빌드 도구
빌드를 쉽게 해주기 위해 만들어진 도구이다.   

* Apache Ant
* Maven
* Gradle   

#### Apache Ant
XML 형식으로 작성되며, 자유도가 높다는 특징이 있다. 그리고 절차적으로 작성이 되고 스크립트를 직접적으로 명시하며 다양한 Task가 가능하다.   

그러나 스크립트를 재사용할 수 없고, 복잡해질수록 구조 및 스크립트 파악이 어렵다.

#### Maven
pom.xml 형식으로 작성되며 전체적인 프로젝트 관리가 가능하다. 그리고 편리한 의존성 관리와 다운로드가 가능하다. 표준화된 빌드 스크립트이며 Lib가 존재하여 빌드 속도가 빨라진다.   

그러나 지원하지 않는 복잡한 빌드 과정 추가 시 난이도가 올라간다. 그리고 pom.xml 관리가 까다롭다. 또한 Repository 관리가 불편하다.   

#### Gradle
<b>Apache Ant</b>와 <b>Maven</b>의 장점들을 모아서 만들어졌다.   

JVM 위에서 동작하는 Groovy 기반으로 작성이 되었으며, 자바 문법과 유사하여 익히기가 쉽다. 그리고 Maven의 세팅 및 중앙 저장소를 활용할 수 있다. 프로젝트를 설정 주입식으로 정의할 수 있으며, 재사용이 용이하다. 또한 Wrapper를 활용하여 Gradle이 설치되어 있지 않아도 사용이 가능하다.   

그러나 Maven에 ㅇ비해 커뮤니티 크기가 적다.   

### Detailed Gradle
|항목|설명|
|:---:|:---:|
|src|자바 소스 파일|
|.gradle|gradle 버전 및 설정 파일|
|settings.gradle|프로젝트 정보 설정|
|build.gradle|프로젝트 빌드에 대한 정의|
|gradlew, gradlew.bat|작동될 gradle 명령 파일들|   

1. settings.gradle   
프로젝트 빌드 정보 설정 보통은 하나지만, 프로젝트의 중복 설정이 되어 멀티 프로젝트 빌드 시 프로젝트 정의 가능 하위 프로젝트들이 어떻게 구성되어 있는지 기록한다.   

예시.
```
rootProject.name = 'java-subway'
```

2. build.gradle   
프로젝트 빌드 정보 및 구성에 대해서 표현한다.   

예시.
```
apply plugin: 'java'
apply plugin: 'eclipses'

version = '1.0.0'
sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    testCompile('org.junit.jupiter:junit-jupiter:5.6.0')
    testCompile('org.assertj:assertj-core:3.15.0')
}

test {
    useJUnitPlatform()
}
```

```
apply plugin: '한국어'
apply plugin: 'eclipses'

version = '1.0.0'
sourceCompatibility = 한국어21세기버전

repositories {
    도서관
}

dependencies {
    알파.부동산학개론
    브라보.그래난정대만
    챠리.초콜릿공장운영론
}

test {
    자동이체테스트
}
```

첫 번째로는 ```어떤 언어를 사용할 것인가?``` ```어떤 버전을 사용할 것인가?```를 정의한다. 그리고 마지막에는 ```어떤 테스트를 사용할 것인가?```를 정의한다.   

### 빌드 도구 - Gradle
자바의 특성은 다양한 운영체제에서 작동하는 것이며, Gradle도 동일하다.   

1. .gradlew, .gradle.bt   
gradle wrapper의 약자로, gradle이 설치되어 있지 않아도, 빌드할 수 있도록 하는 역할을 한다.   

## 배포
빌드가 끝나면 JAR, WAR로 구분이 된다. 이를 사용자가 쓸 수 있도록 <b>배포</b>하거나 웹 사이트를 만드는 등 다양한 것에 사용할 수 있다. 즉, <b>배포</b>는 사용자가 사용할 수 있도록 소프트웨어를 제공하는 과정이다.   

## CI

### 협업 시 문제
1. 마지막에 프로젝트 합칠 시, Integration Hell이 발생   
2. 중간 사이에 프로젝트 합칠 시, 지속적으로 시간이 소모   

이런 문제를 해결하기 위해 CI (Continuous Integration)을 사용한다.   

```
CI는 <b>지속적 통합</b>이라고 부르며, 코드 변경 사항마다 <b>빌드</b>에서 <b>테스트</b>까지 자동으로 진행하고 결과물을 보고 받고 레포지토리에 <b>자동으로 통합</b>되는 프로세스이다.
```

### CI Tools
* Travis
* Jenkins
* Git Actions

빌드의 실패, 충돌, 테스트 통과 실패, 빌드 성공 등의 결과물들을 Slack(슬랙)이나 메세지로 받을 수 있다.   

### CI 특징
* 변경 사항이 클래스, 기능을 더 나아가 전체 애플리케이션에서의 테스트를 수월하게 수행하게 한다.
* 신규 코드와 기존 코드의 충돌을 빠르게 수정이 가능하다.
* 협업 시에 애플리케이션이 최신 상태로 유지될 수록 한다.   

### Travis Tool
<b>Github</b>와 연계가 좋으며, 클라우드 기반으로 <b>서버 없이</b> 작동이 가능하다. 그리고 <b>yml 형식</b>을 통해 쉽게 설정이 가능하고 모든 작업들이 <b>독립적</b>이다.   

그러나 유료 서비스이며 상대적으로 플러그인이 <b>부족</b>하다.   

### Jenkins
다양한 <b>IDE</b>를 지원하고 호스팅을 직접 하기 때문에 <b>커스텀마이징</b>이 가능하다. 그리고 가장 큰 커뮤니티를 가지고 있기 때문에 문서가 다양하다.   

그러나 플러그인이 중구난방으로 <b>파편화된</b> 세팅을 갖고 있으며, 규모가 작아도 따로 서버를 운영해야 한다. 그리고 서버 운영 비용이 발생한다.   

## CD (Continuous Deployment)
빌드가 완료되고 나서 테스트 서버 혹은 메인 서버에 <b>자동</b>으로 배포해주는 기술이 필요한데, 이를 CD가 수행해준다.   

즉, 개발자들이 코드에 변경 사항을 줄 경우, 파이프 라인을 통해 이동하여 프로덕션 단계까지 ```자동으로 배포```되는 <b>프로세스</b>이다. (Repository까지만 가고 수동으로 배포하는 프로세스의 경우 Continuous Delivery가 구축되었다고 한다.)   

### CD 특징
* 애플리케이션을 프로덕션으로 빠르고 쉽게 배포가 가능하다.
* 소비자들의 요구를 빠르게 만족시키는 서비스 출시가 가능하다.
* 개발팀과 운영팀의 간극을 메어주어 생산성을 향상시킨다.   

```
(CD)
(CONTINUOUS INTEGRATION)
BUILD => TEST => MERGE =>

   (CONTINUOUS DELIVERY)
=> AUTOMATICALLY RELEASE TO REPOSITORY =>

   (CONTINUOUS DEPLOYMENT)
=> AUTOMATICALLY DEPLOY TO PRODUCTION

   (CI & CD)
=> 운영, 모니터링
```

## DevOps
Development와 Operation을 결합한 단어이며, ```개발```과 ```운영```이 <b>연계</b>하여 협력해 서비스를 이끌어 나가는 방법론이다.

