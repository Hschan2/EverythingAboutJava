# 인증과 인가

## 인증과 인가 정의
* 인증: 나는 누구인가. 즉, 사용자를 확인하는 것
* 인가: 나의 권한은 어디까지인가. 즉, 사용자의 실행시킬 수 있는 권한

### 인증을 자세히 들어가기 전, HTTP란?
HTTP는 한 번 통신하면 끝나는 비연결을 지향한다. 그리고 서버가 클라이언트의 상태를 보유하고 있지 않는 상태없음을 가지고 있다.   

* HTTP 특징
    * 비연결지향
    * 상태없음   

#### 상태없음
서버가 클라이언트의 상태를 보존하지 않는 것을 의미한다.   

* 장점
    * 서버의 리소스를 절약할 수 있다.
    * 서버 확장성에 용이하다.
* 단점
    * 상태를 보존하지 않는다.   

이러한 특징으로 똑같은 서버를 여러 대 띄어도 같은 요청하는 응답을 받을 수 있다.   

## 쿠키와 세션 그리고 토큰
인증을 유지하기 위한 기술들을 의미한다.

### 쿠키
<b>쿠키</b>는 브라우저에 저장된다. 쿠키의 흐름은 다음과 같다.   

1. 서버에서 Set-Cookie 헤더에 key=value를 포함해 보낸다.   
2. 클라이언트는 Set-Cookie 헤더 기반으로 브라우저에 저장한다.   
3. 다음 요청부터는 Cookie 헤더에 key=value를 포함해 보낸다.   

쿠키를 저장할 때는 아래와 같은 설정이 존재한다.   
* Domain: 쿠키의 대표 서버
* Expiration 만료 기간
* Host Only: 요청 도메인과 쿠키의 대표 서버가 같아야 함
* Session (Session Cookie): 브라우저가 종료될 때까지 유지
    * Persistent Cookie: 디스크에 저장되어 영구적으로 지속
* Secure: 보안을 위함 (Https에서 사용 가능)
* Http Only: Client-side 스크립트에서 접근 불가   

* 쿠키의 단점
    * 보안에 취약하다. (요청에 포함된 쿠키 헤더가 해킹에 위험)

### 세션
<b>세션</b>은 서버에 데이터가 저장된다. 세션의 흐름은 아래와 같다.   

1. 클라이언트가 서버에 접속 시 세션 ID를 발급받는다.   
2. 클라이언트는 세션 ID를 쿠키로 저장하고 가지고 있다.   
3. 클라이언트는 요청할 때, 세션 ID와 함께 서버에 요청한다.   
4. 서버는 세션 ID로 저장되어 있는 클라이언트 정보를 확인한다.   

* 세션의 장점
    * 쿠키에 비해 비교적 안전하다.
* 세션의 단점
    * Http의 상태없음 특징이 사라진다.
    * 서버를 확장하는 데에 부담이 된다.
    * 멀티 디바이스 환경에서 신경써야 할 부분이 있다.
    * 유저 정보를 서버 메모리에 들고 있게 된다. => 큰 트래픽일 경우 서버 메모리에 부담 => 토큰 등장   

### 토큰
<b>토큰</b>은 쿠키와 비슷하게 브라우저에 저장된다. 그러나 쿠키와 다른 점은 key-value를 저장하는 것이 아니라 유저를 식별할 수 있는 토큰을 저장한다. 토큰의 흐름은 아래와 같다.   

1. 클라이언트는 로그인을 한다.   
2. 정보가 맞다면 서버는 클라이언트에게 토큰을 제공한다.   
3. 다음 요청부터는 Authorization 헤더에 토큰을 포함해서 요청한다.   
4. 토큰을 확인(토큰의 무결성도 확인)하여 사용자의 정보를 확인한다.   

* 토큰의 장점 (세션과 비교)
    * 서버의 메모리에 부담이 적다.
    * 서버를 확장하는 데에 부담이 적다.
    * 멀티 디바이스 환경에서 사용하기 편하다.
* 토큰의 단점
    * 강제로 만료시킬 수 없다. (토큰이 탈취되었을 때, 강제로 만료해야 한다.) => 유효 기간을 짧게 설정하여 보완

[인증과 인가](https://www.youtube.com/watch?v=TXWUNePimAc)