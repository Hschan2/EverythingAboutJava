# 프론트엔드 성능 측정

## 프론트엔드의 성능을 측정해야 하는 이유
고객들이 서비스를 사용하다가 페이지 로딩이 길어져 도중에 서비스를 떠나는 경우가 적지 않는 경우를 발견할 수 있다. 즉, 지연 속도가 늘수록 이탈률 또한 늘어난다. 그리고 구매 전환률 역시 감소한다.   

그래서 프론트엔드의 성능을 측정해야 하는 이유는 <b>사용성 개선을 통한 이익 증대</b>를 위함이다.   

## 측정해야 하는 프론트엔드 성능
프론트엔드에서 측정할 수 있는 성능으로 크게 로딩 시간, 렌더 시간, 메모리 누수 확인이 있다.   

* 로딩 시간(로딩 속도)
    * FCP(First Contentful Paint): 첫 요소가 로드될 때까지 걸리는 시간
    * FMP(First Meaningful Paint): 사용자에게 의미있는 첫 요소가 로드될 때까지 걸리는 시간
    * LCP(Largest Contentful Paint): 주요 콘텐츠가 로드될 때까지 걸리는 시간   

FMP의 경우 약 20%의 항목에서 정확하지 않다고 하여, 현재는 LCP를 기준으로 로딩 속도를 측정한다. (LCP 기준: 2.5초 이하: 좋음, 2.5초 이상 4초 이하: 개선 필요, 4초 이상: 좋지 않음)   

## 브라우저 렌더링 과정
1. Javascript: 페이지에 DOM 요소 추가 등 시각적 변화를 일으키는 작업 처리   
2. Style: CSS를 어떤 DOM 요소에 적용해야 할지 계산   
3. Layout: 각 요소의 너비나 위치를 계산해 화면 상에 배치   
4. Paint: 각 요소에 배경색, 글자 색, 그림자 등 픽셀 채우기   
5. Composite: 이전 과정에서 생성된 레이어 병합   

브라우저 렌더링 과정의 시간이 얼마나 걸리는지 측정하여 렌더링을 측정할 수 있다.   

## 메모리 누수
* 자바스크립트는 <b>Garbage Collecting Language</b>로 메모리 누수 문제가 적은 편이다. (Garbage Collecting Language: 이전에 할당된 메모리 영역이 응용 프로그램의 다른 부분에서 다시 참조될 수 있는지 주기적으로 확인하는 언어)   

* 자바스크립트의 메모리 누수
    * 주로 <b>원치 않는 참조(Unwanted References)</b>에 의해 발생한다.   

* 자바스크립트 메모리 누수 원인
    * 전역변수
    * 해제되지 않은 타이머 및 콜백
    * 돔 외부에서의 참조
    * 잘못된 클로저 사용
    * 등등

### Web Vitals (구글의 필수적인 성능 지침 정의)
* LCP (Loading): 2.5초 이하는 좋음, 2.5초 이상 4초 이하는 개선 필요, 4초 이상은 좋지 않음
* FID (Interactivity): 사용자의 행동에 대해 이벤트 핸들러가 작동할 때까지의 시간. 100ms 이하는 좋음, 100ms 이상 300ms 이하는 개선 필요, 300ms 이상은 좋지 않음
* CLS (Visual Stability): 시각적인 안정성을 측정(시작 위치에서 레이아웃이 얼마나 변화하는지에 대한 측정). 0.1 이하는 좋음, 0.1 이상 0.25 이하는 개선 필요, 0.25 이상은 좋지 않음   

* 그 외 프론트엔드 측정하는데 사용되는 기준: 애셋 최적화, 빌드 최적화, 전송 최적화, 네트워킹, 테스트 및 모니터링 등등   

## 프론트엔드 성능 측정하는 방법
* 크롬 개발자 도구
    * Lighthouse: WebVitals를 이용하여 성능을 측정하고 결과 제공
    * Performance: 직접 원하는 구간에 녹화함으로써 네트워크, 렌더링, 메모리 전반에 관한 사항 확인 가능
    * Memory: 현재 메모리 사용률 확인 가능하며 스냅샷 간 비교하여 누수 확인 가능
    * Network: 네트워크 요청이 처리되는 시간 확인 가능
* React
    * Profiler: 컴포넌트 별 렌더링 시간 파악 및 인터랙션 추적 가능
* 모니터링 도구 : 실시간으로 네트워크 로딩 속도, Ajax 요청 속도 등을 모니터링
    * 제니퍼 프론트(Jennifer Front)
    * 뉴렐릭(Newrelic)

## 성능 측정 시 고려할 점
* 서비스에 맞는 성능 개선 요소에 집중하기
    * 예. 넷플릭스: 키 입력의 반응 속도, 메모리, 사용자 입력 안정화 대기 시간에 집중
    * 예. 위키피디아: 정보가 화면에 로드되는 속도, CPU 소요 시간에 집중
* 기본 환경에서 측정
    * 확장 프로그램과 같이 성능에 영향을 미치는 요소 제거
    * 측정 결과의 정확도에 영향을 줄 수 있기 때문에 가장 기본적인 상태에서 측정
    * 크롬 개발자 도구를 이용하는 경우 시크릿 모드 사용

## 성능 측정이 필요한 이유
* 타겟 사용자 환경에 맞춰 데이터 수집하기
    * 모바일 사용자 대상으로 할 때, 웹 환경에서의 성능 측정은 소용 없음
    * 기기를 이용해 성능 측정하기

## 정리
* 프론트엔드에서 성능 측정을 하는 이유: 사용성 개선을 통한 이익 증대를 위해
* 프론트엔드에서 측정해야 하는 성능 요소: 로딩 속도와 렌더링 속도, 메모리 누수
* 성능 측정하는 방법: 크롬, 리액트 프로파일러, 실시간 모니터링 도구 등을 이용
* 성능 측정 시 고려할 것들: 서비스 성격, 측정 환경 통일, 서비스 타겟

[프론트엔드 성능 측정](https://www.youtube.com/watch?v=A6J74xLWqYg)